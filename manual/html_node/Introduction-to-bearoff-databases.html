<html lang="en">
<head>
<title>GNU Backgammon</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Backgammon">
<meta name="generator" content="makeinfo 4.3">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home">
</head>
<body>
<div class="node">
<p>
Node:<a name="Introduction%20to%20bearoff%20databases">Introduction to bearoff databases</a>,
Next:<a rel="next" accesskey="n" href="Bearoff-databases-with-GNU-Backgammon.html#Bearoff%20databases%20with%20GNU%20Backgammon">Bearoff databases with GNU Backgammon</a>,
Up:<a rel="up" accesskey="u" href="Bearoff-databases.html#Bearoff%20databases">Bearoff databases</a>
<hr><br>
</div>

<h3 class="section">Introduction to bearoff databases</h3>

   <p>There are two kind of bearoff databases: two-sided (exact) bearoff databases
or one-sided (approximative) bearoff databases.

<h4 class="subsection">Two-sided bearoff databases</h4>

   <p>Two-sided bearoff databases contain exact probabilities or equities
for winning.

   <p>For example, for less than 6 chequers inside the home quadrant, each
side has 924 different positions, for a total of 924 * 924 = 853,776
positions possible. The bearoff database will contain the exact
winning probability for each of these 853,776 positions. Typically,
the database also includes cubeful equities for money game. Cubeful
equities for match play is generally not included as it is dependent
on match score and cube level.

   <p>Consider the following position:

<pre class="example">      GNU Backgammon  Position ID: CgAAEAEAAAAAAA
                      Match ID   : cIkMAAAAAAAA
      +13-14-15-16-17-18------19-20-21-22-23-24-+     O: gnubg
      |                  |   |          O  O    | OOO 0 points
      |                  |   |                  | OOO
      |                  |   |                  | OOO
      |                  |   |                  | OO
      |                  |   |                  | OO
     v|                  |BAR|                  |     (Cube: 1)
      |                  |   |                  | XX
      |                  |   |                  | XX
      |                  |   |                  | XXX
      |                  |   |                  | XXX On Roll
      |                  |   |    X        X    | XXX 0 points
      +12-11-10--9--8--7-------6--5--4--3--2--1-+     X: jth
     </pre>

   <p>Using a two-sided bearoff database will yield that player X has 67.1%
cubeless chance of winning. The database also gives cubeful money
equities of +0.3441, +0.3210, and +0.1605 for X owning cube, centred
cube, and O owning cube, respectively. So it's an initial
double since +0.3210 &gt;= 2 * +0.1605. However it's not a redouble since
+0.3441 &gt;= 2 * 0.1605.

   <p>The major problem with two-sided databases is that the size increases
incredible fast with the number of points and chequers:

   <p><table><tr align="left"><td valign="top"><strong>Chequers</strong>
</td><td valign="top"><strong>Points</strong>
</td><td valign="top"><strong>Number of positions</strong>
<br></td></tr><tr align="left"><td valign="top">6         </td><td valign="top">6        </td><td valign="top">853,776
<br></td></tr><tr align="left"><td valign="top">7         </td><td valign="top">6        </td><td valign="top">2,944,656
<br></td></tr><tr align="left"><td valign="top">8         </td><td valign="top">6        </td><td valign="top">9,018,009
<br></td></tr><tr align="left"><td valign="top">... 
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">6        </td><td valign="top">2,944,581,696
<br></td></tr><tr align="left"><td valign="top">... 
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">24       </td><td valign="top">18,528,584,051,601,162,496
   <br></td></tr></table>

   <p><tt>gnubg</tt> stores the equity for each position with a precision of
approximately 0.00003 which requires 2 bytes of storage. Hence,
storing one cubeless and three cubeful equities requires a total of 8
bytes per position. This gives the following storage requirements for
n chequers inside the home quadrant:

   <p><table><tr align="left"><td valign="top"><strong>Chequers</strong>
</td><td valign="top"><strong>Points</strong>
</td><td valign="top"><strong>Number of positions</strong>
</td><td valign="top"><strong>Size/MB</strong>
<br></td></tr><tr align="left"><td valign="top">6         </td><td valign="top">6        </td><td valign="top">853,776        </td><td valign="top">6
<br></td></tr><tr align="left"><td valign="top">7         </td><td valign="top">6        </td><td valign="top">2,944,656      </td><td valign="top">22
<br></td></tr><tr align="left"><td valign="top">8         </td><td valign="top">6        </td><td valign="top">9,018,009      </td><td valign="top">68
<br></td></tr><tr align="left"><td valign="top">9         </td><td valign="top">6        </td><td valign="top">25,050,025     </td><td valign="top">191
<br></td></tr><tr align="left"><td valign="top">10        </td><td valign="top">6        </td><td valign="top">64,128,064     </td><td valign="top">489
<br></td></tr><tr align="left"><td valign="top">11        </td><td valign="top">6        </td><td valign="top">153,165,376    </td><td valign="top">1,168
<br></td></tr><tr align="left"><td valign="top">12        </td><td valign="top">6        </td><td valign="top">344,622,096    </td><td valign="top">2,629
<br></td></tr><tr align="left"><td valign="top">13        </td><td valign="top">6        </td><td valign="top">736,145,424    </td><td valign="top">5,616
<br></td></tr><tr align="left"><td valign="top">14        </td><td valign="top">6        </td><td valign="top">1,502,337,600  </td><td valign="top">11,461
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">6        </td><td valign="top">2,944,581,696  </td><td valign="top">22,465
   <br></td></tr></table>

   <p>For the typical user the limit is probably 10 or 11 chequers unless
she owns vast amounts of disk space. 
Also, the time to generate these databases increases
proportionally with the size. The 15 chequer database takes at least
3,500 times the time it takes to generate the 6 point database. For
example, on the author's 1GHz Pentium III it takes approximately 6
minutes to generate the 6
points database, hence it would take at least 21,000 minutes or
approximately 15 days to generate the 15 point database on the same
computer.

<h4 class="subsection">One-sided bearoff databases</h4>

   <p>Instead of looking at both player's positions simultaneously large
savings can be obtained by looking at each side independently. For
each position we tabulate the probability P(n) what the player will
bear all chequers off in n rolls; P(n) is the one sided bearoff
distribution. Assume player 0 and player 1 has one sided bearoff
distributions P0(n) and P1(n), respectively. The chance of player 0
bearing all chequers off before player 1 is:

   <p>p = sum(i=0 to infinity) P0(i) [ sum(j=i to infinity) P1(j) ]

   <p>For example, consider the following position:

<pre class="example">      GNU Backgammon  Position ID: 2x0AAOi2AQAAAA
                      Match ID   : cAkAAAAAAAAA
      +13-14-15-16-17-18------19-20-21-22-23-24-+     O: gnubg
      |                  |   |       O  O  O  O | O   0 points
      |                  |   |       O  O  O  O | O
      |                  |   |       O  O       | O
      |                  |   |                  | O
      |                  |   |                  | O
     v|                  |BAR|                  |     (Cube: 1)
      |                  |   |                  | X
      |                  |   |                  | X
      |                  |   |             X    | X
      |                  |   |    X  X  X  X    | X   On roll
      |                  |   |    X  X  X  X  X | X   0 points
      +12-11-10--9--8--7-------6--5--4--3--2--1-+     X: jth
     </pre>

   <p>The one sided bearoff distributions are
   <p><table><tr align="left"><td valign="top"><strong>Rolls</strong> </td><td valign="top"><strong>jth</strong> </td><td valign="top"><strong>gnubg</strong>
<br></td></tr><tr align="left"><td valign="top">3 </td><td valign="top">1.917% </td><td valign="top">2.811%
<br></td></tr><tr align="left"><td valign="top">4 </td><td valign="top">18.749% </td><td valign="top">28.403%
<br></td></tr><tr align="left"><td valign="top">5 </td><td valign="top">44.271% </td><td valign="top">50.307%
<br></td></tr><tr align="left"><td valign="top">6 </td><td valign="top">32.998% </td><td valign="top">18.114%
<br></td></tr><tr align="left"><td valign="top">7 </td><td valign="top">2.029% </td><td valign="top">0.363%
<br></td></tr><tr align="left"><td valign="top">8 </td><td valign="top">0.037% </td><td valign="top">0.002%
   <br></td></tr></table>

   <p>Applying the formula above gives:

   <p>1.917% * 100% + 18.749% * 97.189% + 44.271% * 68.786% ... +
0.037% * 0.02% = 56.7%

   <p>The cubeless gwc's calculated from one sided bearoff distributions are
usually quite good, although no thorough investigations have been
performed so far. Although the databases are one sided they can also
give correct moves in "desperation" scenarios.

   <p>By storing the probability to bearoff at least one chequer, it's also
possible to calculate gammon probabilities, as the chance of being
gammoned is the probability that my opponent bears all chequers off
before I bear at least one chequer off. Analogously, it's possible to
calculate the chance of gammoning the opponent.

   <p>The storage requirements are much smaller than for the equivalent two
sided databases.

   <p><table><tr align="left"><td valign="top"><strong>Chequers</strong>
</td><td valign="top"><strong>Points</strong>
</td><td valign="top"><strong>Number of positions</strong>
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">6        </td><td valign="top">54,264
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">7        </td><td valign="top">170,544
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">8        </td><td valign="top">490,314
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">9        </td><td valign="top">1,307,504
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">10       </td><td valign="top">3,268,870
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">11       </td><td valign="top">7,726,160
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">12       </td><td valign="top">17,383,860
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">13       </td><td valign="top">37,442,160
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">14       </td><td valign="top">77,558,760
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">15       </td><td valign="top">155,117,250
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">16       </td><td valign="top">300,540,195
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">17       </td><td valign="top">565,722,720
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">18       </td><td valign="top">1,037,158,320
   <br></td></tr></table>

   <p>For example, 15 chequers on 6 points is only 54,264 positions for the
one sided bearoff database compared to 294,458,696 positions for the
equivalent two sided bearoff database. However, for each position we
need to store an array of probabilities. For example, for 15 chequers
on the 18 point we have to store 15 non-zero probabilities compared to
only one in the two sided bearoff database. The table below gives
approximate database sizes for <tt>gnubg</tt>'s one sided databases (both
bearoff and gammon distributions):

   <p><table><tr align="left"><td valign="top"><strong>Chequers</strong>
</td><td valign="top"><strong>Points</strong>
</td><td valign="top"><strong>Size in MB</strong>
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">6        </td><td valign="top">1.4
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">7        </td><td valign="top">5
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">8        </td><td valign="top">15
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">9        </td><td valign="top">42
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">10       </td><td valign="top">112
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">11       </td><td valign="top">284
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">12       </td><td valign="top">682
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">13       </td><td valign="top">1,543
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">14       </td><td valign="top">approx 4,300
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">15       </td><td valign="top">approx 10,700
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">16       </td><td valign="top">approx 26,700
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">17       </td><td valign="top">approx 66,700
<br></td></tr><tr align="left"><td valign="top">15        </td><td valign="top">18       </td><td valign="top">approx 166,000
   <br></td></tr></table>

   <p>So, the practical limit is probably around the 11 to 13 point,
depending on the disk space available.

   <p><tt>gnubg</tt> can generate one sided bearoff database where the exact
bearoff distribution is approximated by a normal distribution: instead
of storing up to 15 or 20 non-zero probabilities only two parameters
characterising the normal distribution has to be stored: the mean and
the variance. The approximative distributions yields reasonably
accurate gwc's and gammon probabilities compared to the exact one
sided bearoff database. The size of the these approximative databases
are roughly a quarter of the exact one, hence the limit is around the
13 to 15 point depending on the disk space available. The option to
use approximative bearoff databases is work in progress!

   <p>As with the two sided bearoff databases it can be a rather time
consuming task to generate one sided databases. The 10 point database
takes approximately 2 hours to generate on the author's 1 GHz Pentium
III. The 12 point database may more than one day!

<h4 class="subsection">Hypergammon databases</h4>

   <p><tt>gnubg</tt> can also play Hypergammon; a variant of backgammon with only
3 chequers, but with counting gammons and backgammons. The starting
position is

<pre class="example">      GNU Backgammon  Position ID: AACgAgAAKgAAAA
                      Match ID   : cAkAAAAAAAAA
      +13-14-15-16-17-18------19-20-21-22-23-24-+     O: gnubg
      |                  |   |          X  X  X |     0 points
      |                  |   |                  |
      |                  |   |                  |
      |                  |   |                  |
      |                  |   |                  |
     v|                  |BAR|                  |     (Cube: 1)
      |                  |   |                  |
      |                  |   |                  |
      |                  |   |                  |
      |                  |   |                  |     On roll
      |                  |   |          O  O  O |     0 points
      +12-11-10--9--8--7-------6--5--4--3--2--1-+     X: jth
     Pip counts: O 69, X 69
     </pre>

   <p><tt>gnubg</tt> can also play the two-chequer and one-chequer variations as
well. Although it looks very simple to play, Hypergammon is in fact
quite difficult to play correctly.

   <p>There are 3,276 possible ways to distribute 3 (or less) chequers over 25 points
(the 24 points plus the bar). This gives a total of 10,732,176
possible two sided positions. However, many these are illegal:

   <p><table><tr align="left"><td valign="top"><strong>Position type</strong>
</td><td valign="top"><strong>Number of positions</strong>
<br></td></tr><tr align="left"><td valign="top">Game over         </td><td valign="top">6,551
<br></td></tr><tr align="left"><td valign="top">Race (no contact) </td><td valign="top">587,926
<br></td></tr><tr align="left"><td valign="top">Contact           </td><td valign="top">7,365,427
<br></td></tr><tr align="left"><td valign="top">Illegal positions </td><td valign="top">2,772,272
<br></td></tr><tr align="left"><td valign="top">Total             </td><td valign="top">10,732,176
   <br></td></tr></table>

   <p>So there is close to 8 million legal positions for Hypergammon. Since
this is a relative small number it's possible to tabulate the game
winning chance, cubeless equity, or cubeful equities for all
positions.

   <p>Due to the contact positions it is not possible to generate such a
database in one run; instead the process is iterative: (a) "guess"
equities for the 8 million positions, (b) use these equities to calculate 1-ply
equities for all positions, and (c) if the equities change
significantly then go back to step (c).

   </body></html>

